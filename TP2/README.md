# TP2 : Environnement virtuel

## I. Topologie r√©seau

**üåû Sur node1.lan1.tp2**

 *Afficher ses cartes r√©seau*


```
[Wasteque@node1 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:77:8a:2f brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.11/24 brd 10.1.1.255 scope global noprefixroute enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fe77:8a2f/64 scope link
       valid_lft forever preferred_lft forever
```



*Afficher sa table de routage*


```
[Wasteque@node1 ~]$ ip route show
10.1.1.0/24 dev enp0s3 proto kernel scope link src 10.1.1.11 metric 100
10.1.2.11 via 10.1.1.254 dev enp0s3
10.1.2.12 via 10.1.1.254 dev enp0s3
```


*prouvez qu'il peut joindre node2.lan2.tp2*


```
[Wasteque@node1 ~]$ ping 10.1.2.12
PING 10.1.2.12 (10.1.2.12) 56(84) bytes of data.
64 bytes from 10.1.2.12: icmp_seq=1 ttl=63 time=4.21 ms
64 bytes from 10.1.2.12: icmp_seq=2 ttl=63 time=2.95 ms
64 bytes from 10.1.2.12: icmp_seq=3 ttl=63 time=3.47 ms
^C
--- 10.1.2.12 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2006ms
rtt min/avg/max/mdev = 2.951/3.542/4.210/0.516 ms
```


*prouvez avec un traceroute que le paquet passe bien par router.tp2*


```
[Wasteque@node1 ~]$ traceroute 10.1.2.12
traceroute to 10.1.2.12 (10.1.2.12), 30 hops max, 60 byte packets
 1  10.1.1.254 (10.1.1.254)  2.378 ms  2.154 ms  2.198 ms
 2  10.1.2.12 (10.1.2.12)  4.830 ms !X  8.703 ms !X  7.656 ms !X
```


## II. Interlude acc√®s internet
**üåû Sur router.tp2**

```
[Wasteque@router ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=113 time=18.4 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=113 time=17.4 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=113 time=17.4 ms
^C
--- 8.8.8.8 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2004ms
rtt min/avg/max/mdev = 17.370/17.724/18.430/0.498 ms
```

```
[Wasteque@router ~]$ ping google.com
PING google.com (216.58.214.78) 56(84) bytes of data.
64 bytes from fra15s10-in-f14.1e100.net (216.58.214.78): icmp_seq=1 ttl=116 time=18.1 ms
64 bytes from fra15s10-in-f78.1e100.net (216.58.214.78): icmp_seq=2 ttl=116 time=18.9 ms
64 bytes from fra15s10-in-f78.1e100.net (216.58.214.78): icmp_seq=3 ttl=116 time=17.4 ms
^C
--- google.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2004ms
rtt min/avg/max/mdev = 17.434/18.130/18.859/0.582 ms
```


**üåû Acc√®s internet LAN1 et LAN2**

*Pour LAN1 :*
```
sudo ip route add default via 10.1.1.254 dev enp0s3
```
*Pour LAN2 :*
```
sudo ip route add default via 10.1.2.254 dev enp0s3
```
*On configure l'adresse d'un serveur DNS de chaque machine avec :*
```
sudo nano /etc/resolv.conf
```

```
[Wasteque@node2 ~]$ sudo cat /etc/resolv.conf
# Generated by NetworkManager
nameserver 10.33.10.2
nameserver 8.8.8.8
```


```
[Wasteque@node2 ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=112 time=19.6 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=112 time=19.7 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=112 time=18.6 ms
^C
--- 8.8.8.8 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2004ms
rtt min/avg/max/mdev = 18.636/19.295/19.686/0.468 ms
```

```
[Wasteque@node2 ~]$ ping google.com
PING google.com (142.250.200.206) 56(84) bytes of data.
64 bytes from mrs08s17-in-f14.1e100.net (142.250.200.206): icmp_seq=1 ttl=113 time=19.9 ms
64 bytes from mrs08s17-in-f14.1e100.net (142.250.200.206): icmp_seq=2 ttl=113 time=19.1 ms
64 bytes from mrs08s17-in-f14.1e100.net (142.250.200.206): icmp_seq=3 ttl=113 time=19.1 ms
^C
--- google.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2005ms
rtt min/avg/max/mdev = 19.090/19.382/19.910/0.373 ms
```


## II. Services r√©seau

### 1. Web web web 

**‚òÄÔ∏è Sur web.lan2.tp2**

*dnf install nginx*

Firewall :

```
[Wasteque@web ~]$ sudo firewall-cmd --add-port=80/tcp --permanent
[sudo] password for Wasteque:
success
[Wasteque@web~]$ sudo firewall-cmd --reload
success
```

*Configuration :*

```
[Wasteque@web ~]$ sudo cat /var/www/site/index.html
```

```
[Wasteque@web ~]$ sudo cat /etc/nginx/conf.d/site.conf
server {
    listen 80;
    server_name site.tp2;

    root /var/www/site/;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }
}
```

*Lancement nginx :*

```
[Wasteque@web ~]$ sudo systemctl status nginx
‚óè nginx.service - The nginx HTTP and reverse proxy server
     Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; preset: disabled)
     Active: active (running) since Thu 2024-10-03 20:46:17 CEST; 2s ago
    Process: 1290 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)
    Process: 1291 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)
    Process: 1292 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)
   Main PID: 1293 (nginx)
      Tasks: 2 (limit: 4674)
     Memory: 3.3M
        CPU: 16ms
     CGroup: /system.slice/nginx.service
             ‚îú‚îÄ1293 "nginx: master process /usr/sbin/nginx"
             ‚îî‚îÄ1294 "nginx: worker process"

Oct 03 20:46:17 web.lan2.tp2 systemd[1]: Starting The nginx HTTP and reverse proxy server...
Oct 03 20:46:17 web.lan2.tp2 nginx[1291]: nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
Oct 03 20:46:17 web.lan2.tp2 nginx[1291]: nginx: configuration file /etc/nginx/nginx.conf test is successful
Oct 03 20:46:17 web.lan2.tp2 systemd[1]: Started The nginx HTTP and reverse proxy server.
```

*V√©rification port 80 :*

```
[Wasteque@web ~]$ sudo ss -ltnp | grep ':80'
LISTEN 0      511          0.0.0.0:80        0.0.0.0:*    users:(("nginx",pid=1294,fd=6),("nginx",pid=1293,fd=6))
LISTEN 0      511             [::]:80           [::]:*    users:(("nginx",pid=1294,fd=7),("nginx",pid=1293,fd=7))
```


**‚òÄÔ∏è Sur node1.lan1.tp2**

```
[Wasteque@node1 ~]$ sudo cat /etc/hosts
10.1.2.12   site.tp2
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
```
```
[Wasteque@node1 ~]$ curl site.tp2
```